## 微信小程序笔记

**主界面的五个组成部分**

菜单栏：

- **帮助**：开发者文档
- **设置**：相关设置

控制栏：

- **模拟器、编译器**
- **编译、预览**
- **详情**

## 小程序代码构成

- **pages**：用来存放所有小程序的页面
- **utils**：用来存放工具性质的模块（例如：格式化时间的自定义模块）
- **app.js**：小程序项目的入口文件
- **app.json**：小程序项目的全局配置文件
- **app.wxss**:小程序项目的全局样式文件
- **project.config.json**：项目的配置文件
- **sitemap.json**：用来配置小程序以及页面手否运行被微信索引

## 小程序页面组成部分

小程序官方建议把所有小程序的页面，都存放在**pages目录**中，以单独的文件夹存在，如图所示：

每个页面由**4个基本**文件组成，他们分别是：

- **.js文件**：页面的脚本文件，存放页面的数据、事件处理函数等
- **.json文件**：当前页面的配置文件，配置窗口的外观、表现等
- **.wxml文件**：页面的模板结构文件
- **.wxss文件**：当前页面的样式表文件

### JSON配置文件

1. JSON配置文件的作用

> **JSON是一种数据格式**，在实际开发中，JSON总是以**配置文件**的形式出现。小程序项目中也不例外：通过不同的.json配置文件，可以对小程序项目进行不同级别的配置。

小程序项目中有4种json配置文件，分别是：

> 1. **app.json**配置文件
> 2. **project.config.json**配置文件
> 3. **sitemap.json**配置文件
> 4. 每个页面文件中的**.json**配置文件
>

#### app.json

> - 当前小程序的全局配置，包括了小程序的**所有页面路径、窗口外观、界面表现、底部tab**等
> - **pages**：用来记录当前小程序所有页面的路径
> - **window**：全局定义小程序所有页面的背景色、文字颜色等
> - **style**：全局定义小程序组件所使用的样式版本
> - **sitmapLocation**：用来指明sitemap.json的位置

#### project.config.json

> - 项目配置文件，用来记录我们对小程序开发工具所做的个性化配置，例如：
> - **setting**：保存了**编译相关的配置**
> - **projectname**：保存的是**项目名称**
> - **appid**：保存的是**小程序的账号ID**

#### sitemap.json

> 微信现已开放**小程序内搜索**，效果类似于PC网页的SEO。sitemap.json文件用来**配置小程序页面是否允许微信索引。**

#### 页面.json

> 小程序的每一个页面，可以使用.json文件来**对本页面的窗口外观进行配置，页面中的配置项会覆盖app.json的window中相同的配置项**。



#### 新建小程序页面

> 只需要在app.json->pages中新增页面的存放路径，小程序开发者工具即可帮我们自动创建对应的页面文件。

#### 修改项目首页

> 只需要调整app.json->**pages**数组中页面路径的前后顺序，即可修改项目的首页。小程序会把排在第一位的页面，当做项目首页进行渲染

#### 1、WXML模板

wxml是小程序框架设计的一套标签语言，用来构建小程序页面的结构，其作用类似于页面开发中的HTML。

#### 2、WXML和HTML的区别

**标签名称不同**

- HTML(div、span、img、a)
- WXML（view、text、image、navigator）

**属性节点不同**

- `<a href="#">超链接</a>`
- `<navigator url="/pages/home/home">超链接</navigator>`

**提供了类似于Vue中的模板语法**

- 数据绑定
- 列表渲染
- 条件渲染

### WXSS

WXSS是一条**样式语言**，用于描述WXML的组件样式，类似于网页开发中的CSS。

### **WXSS和CSS的区别**

**新增了rpx尺寸单位**

- CSS中需要手动进行像素单位换算，例如rem
- WXSS在底层支持新的尺寸单位rpx，在不同大小的屏幕上小程序会自动进行换算。

**提供了全局样式和局部样式**

- 项目根目录中的app.wxss会作用于所有小程序页面
- 局部页面的.wxss样式仅对当前页面生效

**WXSS仅支持部分CSS选择器**

- .class和#id
- element
- 并集选择器、后代选择器
- ::after和::before等伪类选择器

### JS逻辑交互

1、小程序中的.js文件

一个项目仅仅提供界面展示是不够的，在小程序中，我们通过.js文件来处理用户的操作。例如：响应用户的点击、获取用户的位置等等。

2、小程序中.js文件的分类

小程序中的JS文件分为三大类：

**app.js**

- 是**整个小程序项目的入口文件**，通过调用**APP（）**函数来启动整个小程序

**页面.js文件**

- 是**页面的入口文件**，通过调用**page（）**函数来创建并运行页面

普通的.js文件

- 是**普通的功能模块文件**，用来封装**公共的函数或属性供页面**使用





## 组件

**小程序中的组件也是由宿主环境提供的**，开发者可以基于组件快速搭建出漂亮的页面结构。官方把小程序的组件分为了9大类，分别是：

1. **视图容器**
2. **基础内容**
3. **表单组件**
4. **导航组件**
5. 媒体组件
6. map地图组件
7. canvas画布组件
8. 开放能力
9. 无障碍访问

#### 

![image-20220905152407985](/wxImg/wx01.png)



**只有text组件支持长按复制**

```html
<rich-text nodes="<h1 style='color: red'>标题</h1>"></rich-text> 
```

![image-20220905153248145](/wxImg/wx02.png)

### 小程序API的三大分类：

**事件监听API：**

- 特点：以**on**开头，用来**监听某些事件的触发。**
- 举例：wx.**onWindowResize**(function callback)监听窗口尺寸变化的事件

**同步API：**

- 以**Sync**结尾的API都是同步API
- 同步API的执行结果，可以通过函数返回值直接获取，如果执行出错会抛出异常
- 举例：wx.**setSorageSync**('key', 'value')向本地存储写入内容

**异步API**

- 特点：类似于jQuery中的**$.ajax(options)**函数，需要通过success、fail、complete接收调用的结果
- 举例：wx.**request**()发起网络数据请求，通过success回调函数接收数据。



## 模板与配置

#### 学习目标：

- 能够使用WXML模板语法渲染页面结构
- 能够使用WXSS样式美化页面结构
- 能够使用app.json对小程序进行全局性配置
- 能够使用page.json对小程序页面进行个性化配置
- 能够知道如何发起网络数据请求

### 

### 数据绑定

1、数据绑定的基本原则

- 在data中定义数据：**在页面对应的.js文件中，把数据定义到data对象中即可。**

```html
Page({
    data:{
    info:'init data',
    msgList:[{msg:'hello'},{msg:'world'}]
    }
})
```



- 在WXML中使用数据

**Mustache语法**——差值表达式  （可使用算数表达式、三元运算符）

### 事件绑定

事件时**渲染层到逻辑层的通讯方式**。通过事件可以将用户在渲染层产生的行为，反馈到逻辑层进行业务的出来

![image-20220905163309007](/wxImg/wx03.png)



#### target和currentTarget的区别

**target**是**触发该事件的源头组件**，而**currentTarget**则是**当前事件所绑定的组件。**

#### bindtap的语法格式

在小程序中，不存在HTML中的onclick鼠标点击事件，而是通过**tap事件**来响应用户的触摸行为。

### 事件传参

小程序中的事件传参比较特殊，**不能在绑定事件的同时为事件处理函数传递参数。**

```html
<button type="primary" bindtap="btnHandler(123)">事件传参</button>
```

**以上代码会将btnHandler(123)作为事件来处理。**

可以为组件提供data-*自定义属性传参，其中 *代表参数名。

例如：

```html
<button bindtap="btnHandler" data-info="{{2}}">事件参数</button>
```

- **info** 会被解析成**参数的名字**
- 数值**2**会被解析为**参数的值**



### wx:if

在小程序中，使用**wx:if=“{{ condition }}”** 来判断是否需要渲染该代码块。

### block

如果要**一次性控制多个组件的展示与隐藏**，可以使用一个`**<block></block>**`标签将多个组件包装起来，并在`<block>`标签上使用wx:if控制元素属性：

```html
<block wx:if="{{true}}">
    <view>view1</view>
    <view>view2</view>
</block>
```

`<block>`**并不是一个组件**，它只是一个包裹性质的容器，**不会在页面做任何渲染**。

### hidden

在小程序，直接使用**hidde=“{{conditon}}”**也能控制元素的显示与隐藏

### wx:if和hidden的对比

1、运行方式不同

- wx:if以**动态创建和移除元素**的方式，控制元素的展示与隐藏。
- hidden以**切换样式**的方式（display:none/block；），控制元素的显示和隐藏。

2、使用建议

- **频繁切换**时，建议使用**hidden**
- **控制条件复杂**时，建议使用**wx:if**搭配wx:elif、wx:else进行展示与隐藏的切换

### wx:for

通过wx:for可以根据指定的数组，循环渲染重复的组件结构，语法实例如下：

```html
<view wx:for="{{array}}">
索引是: {{index}} 当前项是: {{item}}
</view>
```

默认情况下，当前循环项的**索引**用**index**表示；**当前循环项**用**item**表示。

### 手动指定索引和当前项的变量名*

- 使用**wx:for-index**可以指定**当前循环项的索引**的变量名
- 使用**wx:for-item**可以指定**当前项**的变量名

```html
<view wx:for="{{array}}" wx:for-index="idx" wx:for-item="itemName">
索引是： {{idx}} 当前项是：{{itemName}}
</view>
```

### 全局样式和局部样式

1、定义在app.wxss中的样式为**全局样式**，作用于每一个页面。

2、局部样式在**页面.wxss**文件中定义的样式为**局部样式**，只作用于当前页面。

1. 当全局样式和局部样式发生冲突时，根据就近原则，局部样式会**覆盖**全局样式。
2. 当局部样式的**权重大于或等于**全局样式的权重时，才会覆盖全局的样式。

### 全局配置文件及常用的配置项

1. pages
   - 记录当前小程序所有页面的存放路径
2. window
   - 全局设置小程序窗口的外观
3. tabBar
   - 设置小程序底部的tabBar效果
4. style
   - 是否启用新版的组件功能。

### Window常用的配置项

![image-20220909143301714](/wxImg/wx04.png)

### tabbar 的6个组成部分 

1. **backgroupColor**：tabBar的背景色
2. **selectedIconPath**：选中时的图片路径
3. **borderStyle**：tabBar上边框的颜色
4. **iconPath**：未选中时的图片路径
5. **selectedColor**：tab上的文字选中时的颜色
6. **color**：tab上文字的默认（未选中）颜色

## 视图与逻辑

### 声明式导航

1、什么是页面导航？

页面导航指的是**页面之间的互相跳转**。浏览器中实现页面导航的方式有如下两种：

- `<a>`链接
- location.href

2、小程序中实现页面导航的两种方式

1. 声明式导航
   - 在页面上声明一个`<navigator>`导航
   - 通过点击`<navigator>`组件实现页面跳转
2. 编程式导航
   - 调用小程序的导航API，实现页面的跳转                           

## 编程式导航

1. 导航到tabBar页面

   ![image-20230321094627736](/wxImg/wx05.png)

2. 导航到非tabBar页面

   ![image-20230321094831762](/wxImg/wx06.png)

## 生命周期

**生命周期**是指一个对象从创建——>运行->销毁的整个阶段，强调的是一个**时间段**

1. **生命周期的分类**
   1. **应用生命周期**
      - 特指小程序从启动—>运行—>销毁的过程
   2. **页面生命周期**
      - 特指小程序中，每个页面的加载—>渲染—>销毁的过程

其中，**页面**的生命周期**范围较小**、**应用程序**的生命周期的**范围较大**

![image-20230321105920949](/wxImg/wx07.png)

生命周期函数的作用：允许程序员**在特定的时间点，执行某些特定的操作**。

### 生命周期函数的分类

小程序中的生命周期函数分为两类，分别是：

1. - **应用生命周期**
     - 特指小程序从启动—>运行—>销毁依次调用的那些函数
   - **页面生命周期**
     - 特指小程序中，每个页面的加载—>渲染—>销毁依次调用的那些函数

### WXS脚本

1. wxs有自己的数据类型
   - number数值类型、string字符串类型、boolean布尔类型、object对象类型、
   - function函数类型、array数组类型、data日期类型、regexp正则
2. wxs不支持类似于ES6及以上的语法形式
   - **不支持**:let、const、解构赋值、展开运算符、箭头函数、对象属性简写、etc......
   - **支持**：var定义变量、普通fuction函数等类似于ES5的语法
3. wxs遵循CommonJS规范
   - module对象
   - require()函数
   - module.exports对象

### 数据监听器

监听对象中所有属性的变化。

如果某个对象中需要被监听的属性太多，为了方便，可以使用通配符**来监听对象中所有属性的变化，代码如下：

````javascript
observers: {
    //使用通配符**监听对象上所有属性的变化
    'rgb.**':function(obj) {
        this.setData({
            fullColor:`${obj.r},${obj.g},${obj.b`}`
        })
    }
}
````

### 组件的生命周期

在小程序组件中， 最重要的生命周期函数有三个，分别是created、attached、detached。它们各自的特点如下：

1. 组件实例刚被创建好的时候，created生命周期函数会被触发
   - 此时还不能调用setData
   - 通常在这个生命周期函数中，只应该用于给组件的this添加一些自定义的属性字段。
2. 在组件**完全初始化完毕，进入页面节点树后**，attached生命周期函数会被触发
   - 此时，this.data已被初始化完毕
   - 这个生命周期很有用，绝大多数初始化的工作可以在这个时机进行（例如发请求获取初始数据）
3. 在组件离开页面节点树后，detached生命周期函数会被触发
   - 退出一个页面时，会触发页面内每个自定义组件的detached生命周期函数
   - 此时适合做一些清理性质的工作

###  分包基础概念

##### 什么是分包？

分包指的是把一个**完整的小程序项目**，按照需求**划分成不同的子包**，在构建时打包成不同的分包，用户在使用时**按需进行加载**

##### 分包的好处

对小程序进行分包的好处主要有以下两点：

- 可以**优化小程序首次启动的下载时间**  
- 在**多团队共同开发**时可以更好**解耦协作**

#### 引用原则

独立分包和普通分包以及主包之间，是**相互隔绝的**，**不能相互引用彼此的资源**！例如：

1. 主包**无法引用**独立分包的私有资源
2. 独立分包之间，**不能相互引用**私有资源
3. 独立分包和普通分包之间，**不能相互引用**私有资源 
4. **特别注意**：独立分包中不能引用主包内的公共资源。

### 总结

1. 能够知道如何安装和配置vant-weapp组件库
   - 参考vant的官方文档
2. 能够知道如何使用MobX实现全局数据共享
   - 安装包、**创建Store、参考官方文档进行使用**
3. 能够哦知道如何对小程序的API进行Promise化
   - 安装包、在app.js中进行配置
4. 能够知道如何实现自定义tabBar的效果
   - **Vant组件库 + 自定义组件 + 全局数据共享**

